<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Aula Corporativa - Login</title>

  <!-- CSS embebido: Variables (primary/secondary/text), estilos modernos y responsive -->
  <style>
    :root{
      --primary-color: #00375F; /* color principal (tenant override) */
      --secondary-color: #D00000; /* color secundario */
      --text-color: #0b2233; /* color de texto principal */
      --muted: #6e7883; /* texto secundario */
      --accent-color: #f4f6f8; /* fondo de secciones */
      --card-bg: #ffffff;
      --overlay-color: rgba(2,10,20,0.45); /* overlay oscuro */
      --glass: rgba(255,255,255,0.6);
      --radius: 14px;
      --shadow-lg: 0 18px 60px rgba(2,12,30,0.14);
      --shadow-sm: 0 8px 26px rgba(2,12,30,0.06);
      --max-width: 1100px;
      --font-sans: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
    }

    /* Reset */
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:var(--font-sans);
      color:var(--text-color);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      background: linear-gradient(180deg,#f7fafc 0%, #eef2f6 100%);
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
      padding:clamp(1rem,3vw,2rem);
    }

    /* background image + overlay (aplicado vía JS) */
    .bg {
      position:fixed; inset:0; z-index:-2;
      background-size:cover;
      background-position:center;
      background-repeat:no-repeat;
      filter: none;
    }
    .bg::after{
      content:""; position:absolute; inset:0;
      background: var(--overlay-color);
      backdrop-filter: blur(6px);
      mix-blend-mode:multiply;
    }

    /* Main container */
    .page {
      width:100%;
      max-width:var(--max-width);
      display:grid;
      grid-template-columns: 1fr 460px;
      gap: clamp(1rem,2.5vw,2rem);
      align-items:center;
      z-index:1;
    }

    /* Navbar (optional) */
    header.site-header {
      position: absolute;
      left: 50%;
      transform: translateX(-50%);
      top: 18px;
      width: calc(100% - 2rem);
      max-width: var(--max-width);
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:1rem;
      z-index: 50;
    }
    .nav-left { display:flex; align-items:center; gap:0.85rem; }
    #tenant-logo {
      max-width: 160px;
      max-height: 48px;
      height: auto;
      width: auto;
      object-fit: contain;
      display:block;
    }
    nav.site-nav { display:flex; gap:0.5rem; align-items:center; }
    nav.site-nav a {
      text-decoration:none; color:var(--text-color);
      font-weight:600; padding:0.45rem 0.7rem; border-radius:8px;
      transition: all .12s ease;
      font-size:0.95rem;
    }
    nav.site-nav a:hover { background: rgba(0,0,0,0.04); }

    /* Left branding panel */
    .brand {
      background: linear-gradient(180deg, rgba(255,255,255,0.5), rgba(255,255,255,0.35));
      padding: clamp(1.25rem,2.5vw,2rem);
      border-radius: var(--radius);
      box-shadow: var(--shadow-sm);
      min-height:420px;
      display:flex;
      flex-direction:column;
      gap:1rem;
    }
    .brand-header { display:flex; gap:1rem; align-items:center; }
    .brand-title {
      font-size: clamp(1.6rem,3.4vw,2.4rem);
      font-weight:800;
      color:var(--primary-color);
      line-height:1;
    }
    .brand-sub { color:var(--muted); font-size:1rem; }

    /* Right card / login */
    .card-wrap { perspective:1400px; width:100%; max-width:460px; margin-inline:auto; }
    .card {
      width:100%; border-radius:18px; transform-style:preserve-3d;
      transition: transform 700ms cubic-bezier(.2,.9,.2,1);
      position:relative;
    }
    .card.is-flipped { transform: rotateY(180deg); }
    .card-face {
      backface-visibility: hidden;
      border-radius:inherit;
      overflow:hidden;
      background: linear-gradient(180deg, var(--card-bg), #fbfcfd);
      box-shadow: var(--shadow-lg);
      padding:1.25rem;
      min-height:420px;
      display:flex; flex-direction:column; gap:0.8rem;
      position:relative;
    }
    .card-back { transform:rotateY(180deg); position:absolute; inset:0; }

    .card-top { display:flex; justify-content:space-between; align-items:center; gap:0.6rem; }
    .tabs { display:flex; gap:0.5rem; background:transparent; padding:0.25rem; border-radius:999px; }
    .tab-btn {
      padding:0.42rem 0.85rem; border-radius:999px; cursor:pointer; border:1px solid transparent;
      font-weight:700; font-size:.9rem; color:var(--muted); background:transparent;
    }
    .tab-btn.active { color:var(--primary-color); background: rgba(3,55,95,0.06); }

    form.login-form { display:flex; flex-direction:column; gap:0.75rem; margin-top:0.5rem; }
    label{ font-size:0.82rem; color:var(--muted); font-weight:700; margin-bottom:0.18rem; display:block; }
    input[type="text"], input[type="password"]{
      padding:0.85rem 1rem; border-radius:10px; border:1px solid #e6edf2; font-size:0.95rem;
      outline:none; transition: box-shadow .14s ease, border-color .14s ease;
      width:100%;
    }
    input:focus{
      box-shadow: 0 10px 30px rgba(3,55,95,0.07);
      border-color: rgba(3,55,95,0.12);
    }

    .actions { display:flex; gap:0.6rem; align-items:center; margin-top:0.4rem; }
    .btn {
      display:inline-flex; align-items:center; justify-content:center; gap:0.6rem;
      padding:0.75rem 1rem; border-radius:10px; border:0; font-weight:800; cursor:pointer;
    }
    .btn-primary {
      background: linear-gradient(90deg, var(--primary-color), var(--secondary-color) 75%);
      color: #fff; flex:1; box-shadow: 0 10px 30px rgba(3,55,95,0.12);
    }
    .btn-ghost { background:transparent; color:var(--muted); border:1px solid #e9f0f6; }

    .small { font-size:0.86rem; color:var(--muted); }

    /* Footer flexible 3 columns (up to 9 links) */
    footer.site-footer {
      margin-top:1rem; display:flex; gap:1rem; justify-content:space-between; align-items:flex-start;
      padding-top:0.8rem; border-top:1px solid rgba(2,12,30,0.04); color:var(--muted); font-size:0.9rem;
      flex-wrap:wrap;
    }
    .footer-col { flex:1 1 30%; min-width:140px; display:flex; flex-direction:column; gap:0.35rem; }
    .footer-col h4 { margin:0 0 6px 0; font-size:0.92rem; color:var(--text-color); font-weight:700; }
    .footer-col a { text-decoration:none; color:var(--muted); padding:4px 0; }
    .footer-row { display:flex; gap:1rem; width:100%; }

    /* utils */
    .hidden { display:none !important; }
    @media (max-width:980px){
      .page{grid-template-columns:1fr; align-items:stretch;}
      header.site-header { top:10px; left:10px; right:10px; transform:none; width:auto; }
      .brand { order:2; min-height:120px; padding:1rem;}
      .card-wrap { order:1; }
      .card-face{ min-height:360px; }
      .footer-col { min-width:120px; }
    }
  </style>

  <!-- Optional font -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
</head>

<body>
  <!-- Background element (applied by JS if backgroundImage present) -->
  <div id="bg" class="bg" aria-hidden="true"></div>

  <!-- Navbar (rendered/hidden by JS based on tenant) -->
  <header id="siteHeader" class="site-header" role="banner" style="display:none;">
    <div class="nav-left">
      <img id="tenant-logo" src="assets/img/logo_default.png" alt="Logo tenant" />
    </div>
    <nav id="siteNav" class="site-nav" aria-label="Navegación principal"></nav>
  </header>

  <!-- Main page -->
  <main class="page" role="main" id="appRoot">
    <!-- LEFT: Branding / Welcome -->
    <section class="brand" aria-labelledby="brandTitle">
      <div class="brand-header">
        <div>
          <div id="brandTitle" class="brand-title">Aula Corporativa</div>
          <div id="brandSubtitle" class="brand-sub">Plataforma de capacitación multi-tenant.</div>
        </div>
      </div>

      <p id="brandCopy" class="brand-sub">Accede con tu usuario para iniciar. Alterna la tarjeta para acceso de contratistas.</p>

      <div style="flex:1"></div>

      <div id="brandFooter" class="small">© <span id="brandYear"></span> Aula Corporativa</div>
    </section>

    <!-- RIGHT: Card login (flip) -->
    <aside class="card-wrap" aria-label="Acceso">
      <div id="card" class="card" role="region" aria-live="polite">

        <!-- FRONT -->
        <section class="card-face card-front" aria-label="Login trabajadores">
          <div class="card-top">
            <div>
              <div style="font-weight:800; font-size:1.05rem;">Iniciar sesión</div>
              <div class="small">Trabajadores</div>
            </div>
            <div class="tabs" role="tablist">
              <button class="tab-btn active" data-target="front" aria-pressed="true">TRABAJADORES</button>
              <button id="toBack" class="tab-btn" data-target="back" aria-pressed="false">CONTRATISTAS</button>
            </div>
          </div>

          <form id="formFront" class="login-form" onsubmit="return false;">
            <div>
              <label id="labelUser" for="username">Usuario</label>
              <input id="username" name="username" type="text" autocomplete="username" placeholder="usuario@empresa.com" />
            </div>

            <div>
              <label id="labelPass" for="password">Contraseña</label>
              <input id="password" name="password" type="password" autocomplete="current-password" placeholder="••••••" />
            </div>

            <div class="actions">
              <button id="btnLoginFront" class="btn btn-primary">Ingresar</button>
              <button id="btnHelpFront" type="button" class="btn btn-ghost">Ayuda</button>
            </div>

            <div style="margin-top:6px;" class="small">
              <a href="#" id="forgot">¿Olvidaste tu contraseña?</a>
            </div>

            <footer class="site-footer">
              <div class="small">¿No tienes cuenta? <a href="#" id="register">Regístrate</a></div>
              <div class="small" id="copyrightText"></div>
            </footer>
          </form>
        </section>

        <!-- BACK -->
        <section class="card-face card-back" aria-label="Login contratistas">
          <div class="card-top">
            <div>
              <div style="font-weight:800; font-size:1.05rem;">Acceso Contratistas</div>
              <div class="small">ID de contratista</div>
            </div>
            <div class="tabs" role="tablist">
              <button id="toFront" class="tab-btn" data-target="front">TRABAJADORES</button>
              <button class="tab-btn active" aria-pressed="true">CONTRATISTAS</button>
            </div>
          </div>

          <form id="formBack" class="login-form" onsubmit="return false;">
            <div>
              <label id="labelUserC" for="username_c">ID Contratista</label>
              <input id="username_c" name="username_c" type="text" placeholder="ej: CONTRA-123" />
            </div>

            <div>
              <label id="labelPassC" for="password_c">Contraseña</label>
              <input id="password_c" name="password_c" type="password" placeholder="••••••" />
            </div>

            <div class="actions">
              <button id="btnLoginBack" class="btn btn-primary">Ingresar</button>
              <button id="btnHelpBack" type="button" class="btn btn-ghost">Ayuda</button>
            </div>

            <div style="margin-top:6px;" class="small">
              <a href="#" id="supportBack">Soporte contratistas</a>
            </div>

            <footer class="site-footer">
              <div class="footer-row" id="footerLinksRow"></div>
            </footer>
          </form>
        </section>

      </div>
    </aside>
  </main>

  <!-- Modal root -->
  <div id="modalRoot" aria-live="polite"></div>

  <!-- JS embebido: carga tenants.json, aplica vars, navbar, footer, background, flip, logins -->
  <script>
  (function(){
    const DEFAULTS = {
      companyName: "Aula Corporativa",
      logoUrl: "assets/img/logo_default.png",
      primaryColor: "#00375F",
      secondaryColor: "#D00000",
      textColor: "#0b2233",
      muted: "#6e7883",
      accentColor: "#f4f6f8",
      overlayColor: "rgba(2,10,20,0.45)",
      backgroundImage: null,
      navbar: { enabled: false, items: [] },
      footer: { links: [] }, // expected array of {text, href} up to 9 items
      login: {
        fields: {
          userLabel: "Usuario",
          passLabel: "Contraseña",
          contractorUserLabel: "ID Contratista",
          contractorPassLabel: "Contraseña"
        },
        successRedirect: "profile.html"
      },
      customCss: null
    };

    const qs = s => document.querySelector(s);
    const qsa = s => Array.from(document.querySelectorAll(s));
    const applyVar = (name, val) => document.documentElement.style.setProperty(name, val);

    const host = location.hostname || 'localhost';
    const tenantId = host.split('.').length>2 ? host.split('.')[0] : (host === 'localhost' ? 'demo' : 'default');

    fetch('/tenants.json', { cache: 'no-store' })
      .then(r => { if(!r.ok) throw new Error('no tenants'); return r.json(); })
      .then(data => {
        const tenantRaw = (data && (data[tenantId] || data['default'])) || {};
        // deep-ish merge
        const cfg = Object.assign({}, DEFAULTS, tenantRaw);
        cfg.login = Object.assign({}, DEFAULTS.login, tenantRaw.login || {});
        cfg.login.fields = Object.assign({}, DEFAULTS.login.fields, (tenantRaw.login && tenantRaw.login.fields) || {});
        cfg.footer = Object.assign({}, DEFAULTS.footer, tenantRaw.footer || {});
        cfg.navbar = Object.assign({}, DEFAULTS.navbar, tenantRaw.navbar || {});
        applyConfig(cfg);
      })
      .catch(err => {
        console.warn("No tenants.json — usando defaults", err);
        applyConfig(DEFAULTS);
      });

    function applyConfig(cfg){
      // CSS variables
      applyVar('--primary-color', cfg.primaryColor);
      applyVar('--secondary-color', cfg.secondaryColor);
      applyVar('--text-color', cfg.textColor);
      applyVar('--muted', cfg.muted);
      applyVar('--accent-color', cfg.accentColor);
      applyVar('--overlay-color', cfg.overlayColor);

      // Background image
      const bg = qs('#bg');
      if(cfg.backgroundImage){
        bg.style.backgroundImage = `url('${cfg.backgroundImage}')`;
        bg.style.filter = 'none';
      } else {
        bg.style.backgroundImage = 'none';
        // keep default gradient from body
      }

      // Navbar
      const header = qs('#siteHeader');
      const nav = qs('#siteNav');
      if(cfg.navbar && cfg.navbar.enabled){
        header.style.display = 'flex';
        // logo on left
        const logo = qs('#tenant-logo'); if(logo) logo.src = cfg.logoUrl || DEFAULTS.logoUrl;
        // nav items (limit 5)
        nav.innerHTML = '';
        (cfg.navbar.items || []).slice(0,5).forEach((txt, i) => {
          if(!txt) return;
          const a = document.createElement('a');
          a.href = cfg.navbar.hrefs && cfg.navbar.hrefs[i] ? cfg.navbar.hrefs[i] : '#';
          a.textContent = txt;
          nav.appendChild(a);
        });
      } else {
        header.style.display = 'none';
      }

      // Branding texts
      qs('#brandTitle').textContent = cfg.companyName || DEFAULTS.companyName;
      qs('#brandSubtitle').textContent = cfg.tagline || 'Plataforma de capacitación multi-tenant.';
      qs('#brandCopy').textContent = cfg.description || 'Accede con tu usuario para iniciar. Alterna la tarjeta para acceso de contratistas.';
      qs('#brandYear').textContent = new Date().getFullYear();

      // Labels
      qs('#labelUser').textContent = cfg.login.fields.userLabel;
      qs('#labelPass').textContent = cfg.login.fields.passLabel;
      qs('#labelUserC').textContent = cfg.login.fields.contractorUserLabel;
      qs('#labelPassC').textContent = cfg.login.fields.contractorPassLabel;

      // Footer links: up to 9 links, split in 3 columns
      const footerRow = qs('#footerLinksRow');
      footerRow.innerHTML = '';
      const links = (cfg.footer.links || []).slice(0,9);

      // create 3 cols
      const cols = [[],[],[]];
      links.forEach((lnk, idx) => {
        if(!lnk || !lnk.text) return;
        cols[idx % 3].push(lnk);
      });

      cols.forEach((colLinks, colIndex) => {
        const col = document.createElement('div');
        col.className = 'footer-col';
        if(colLinks.length === 0) {
          col.classList.add('hidden');
        } else {
          const h = document.createElement('h4');
          h.textContent = cfg.footer.titles && cfg.footer.titles[colIndex] ? cfg.footer.titles[colIndex] : `Sección ${colIndex+1}`;
          col.appendChild(h);
          colLinks.forEach(linkObj => {
            const a = document.createElement('a');
            a.href = linkObj.href || '#';
            a.textContent = linkObj.text;
            if(linkObj.target) a.target = linkObj.target;
            col.appendChild(a);
          });
        }
        footerRow.appendChild(col);
      });

      // Logo on brand panel too (in case nav hidden)
      const logoMain = qs('#tenant-logo'); if(logoMain) logoMain.src = cfg.logoUrl || DEFAULTS.logoUrl;

      // Save redirect target
      window.loginRedirect = cfg.login.successRedirect || DEFAULTS.login.successRedirect;

      // Load optional custom CSS
      if(cfg.customCss){
        const link = document.createElement('link');
        link.rel = 'stylesheet'; link.href = cfg.customCss;
        document.head.appendChild(link);
      }

      // Init interactions
      initInteractions();
    }

    function initInteractions(){
      const card = qs('#card');
      const setTab = (t) => {
        if(t === 'back') card.classList.add('is-flipped');
        else card.classList.remove('is-flipped');

        qsa('.tab-btn').forEach(b => {
          const target = b.getAttribute('data-target');
          if((t === 'back' && target === 'back') || (t==='front' && (!target || target==='front'))) b.classList.add('active');
          else b.classList.remove('active');
        });
      };

      qs('#toBack')?.addEventListener('click', ()=> setTab('back'));
      qs('#toFront')?.addEventListener('click', ()=> setTab('front'));
      qsa('.tab-btn').forEach(btn => btn.addEventListener('click', (e) => {
        const t = btn.getAttribute('data-target') || 'front';
        setTab(t);
      }));

      // submit via Enter
      ['username','password','username_c','password_c'].forEach(id => {
        const el = qs('#'+id);
        if(!el) return;
        el.addEventListener('keyup', (e) => {
          if(e.key === 'Enter') {
            if(id.includes('_c')) qs('#btnLoginBack')?.click();
            else qs('#btnLoginFront')?.click();
          }
        });
      });

      // Demo login handlers (replace with API)
      qs('#btnLoginFront')?.addEventListener('click', () => {
        const user = qs('#username').value.trim();
        const pass = qs('#password').value.trim();
        if(!user || !pass) return showModal('Error', 'Ingresa usuario y contraseña', 'error');
        showModal('Bienvenido', 'Inicio de sesión correcto. Redirigiendo...', 'success');
        setTimeout(()=> location.href = window.loginRedirect || 'profile.html', 900);
      });

      qs('#btnLoginBack')?.addEventListener('click', () => {
        const user = qs('#username_c').value.trim();
        const pass = qs('#password_c').value.trim();
        if(!user || !pass) return showModal('Error', 'Ingresa ID y contraseña', 'error');
        showModal('Acceso aprobado', 'Redirigiendo...', 'success');
        setTimeout(()=> location.href = window.loginRedirect || 'profile.html', 900);
      });

      // help / register
      qs('#btnHelpFront')?.addEventListener('click', ()=> showModal('Ayuda', 'Contacta a soporte de tu empresa.', 'info'));
      qs('#btnHelpBack')?.addEventListener('click', ()=> showModal('Ayuda', 'Contacta a tu supervisor.', 'info'));
      qs('#register')?.addEventListener('click', (e)=> { e.preventDefault(); showModal('Registro', 'Solicita creación de cuenta con RRHH.', 'info'); });
      qs('#forgot')?.addEventListener('click', (e)=> { e.preventDefault(); showModal('Recuperar', 'Usa la opción de recuperación de tu empresa.', 'info'); });
    }

    // Modal
    function showModal(title, text, type){
      const root = qs('#modalRoot'); if(!root) return alert(title + "\n" + text);
      root.innerHTML = '';
      const wrap = document.createElement('div'); wrap.className = 'modal';
      wrap.style.position = 'fixed'; wrap.style.inset = 0; wrap.style.display = 'flex'; wrap.style.alignItems = 'center'; wrap.style.justifyContent = 'center'; wrap.style.zIndex = 9999;
      wrap.innerHTML = `
        <div style="position:absolute; inset:0; background:rgba(2,10,20,0.45);" aria-hidden="true"></div>
        <div style="background:var(--card-bg); padding:1rem 1.2rem; border-radius:12px; box-shadow:var(--shadow-lg); min-width:260px; text-align:center;">
          <div style="font-weight:800; margin-bottom:0.35rem;">${title}</div>
          <div style="color:var(--muted); margin-bottom:0.8rem;">${text}</div>
          <div style="display:flex; justify-content:center;"><button id="okModal" class="btn btn-primary">Aceptar</button></div>
        </div>
      `;
      root.appendChild(wrap);
      wrap.querySelector('#okModal').addEventListener('click', ()=> root.innerHTML = '');
      wrap.querySelector('div[aria-hidden="true"]').addEventListener('click', ()=> root.innerHTML = '');
    }

  })();
  </script>
</body>
</html>
