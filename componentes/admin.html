<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Panel de Administración</title>
    
    <!-- Iconos Globales -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Estilos Globales (un nivel arriba) -->
    <link rel="stylesheet" href="./global.css">
    
    <!-- Estilos específicos para esta página de tarjetas -->
    <link rel="stylesheet" href="./admin.css">

    <!-- Supabase Client (si es necesario para el tenant) -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="./supabase-client.js"></script>
</head>
<body>

    <!-- Navbar (Reutilizada de admin.html) -->
    <nav class="top-navbar">
        <div class="logo-section">
            <h2 id="companyName"><i class="fas fa-shield-alt"></i> Panel de Admin</h2>
        </div>
        <div class="nav-actions">
            <!-- Puedes ajustar estos enlaces según necesites -->
            <a href="../profile/profile.html" class="btn btn-outline">
                <i class="fas fa-user-circle"></i> Volver al Perfil
            </a>
            <a href="../index.html" class="btn btn-outline">
                <i class="fas fa-sign-out-alt"></i> Salir
            </a>
        </div>
    </nav>

    <!-- Contenedor Principal -->
    <div class="container">
        
        <header class="admin-header">
            <h1>Panel de Administración</h1>
            <p>Selecciona una sección para gestionar.</p>
        </header>
        
        <!-- Contenedor donde se inyectarán las tarjetas -->
        <div class="card-grid" id="card-container">
            <!-- Las tarjetas se generan dinámicamente con JS -->
        </div>

    </div> <!-- Fin de .container -->


<script>
    // =================================================================
    // LÓGICA DE TARJETAS DINÁMICAS
    // =================================================================
    const supabase = window.supabase;
    
    // Define el array con la información de las tarjetas.
    // Puedes agregar más objetos a este array para crear más tarjetas.
    const adminCards = [
        {
            title: "Gestión de Usuarios",
            description: "Administrar, editar y autorizar a los usuarios de la plataforma.",
            icon: "fas fa-users-cog",
            link: "./users.html?v=2" // Enlace a admin.html (gestión de usuarios)
        },
        {
            title: "Gestión de Cursos",
            description: "Crear, editar y asignar cursos a los usuarios y tenants.",
            icon: "fas fa-book-open",
            link: "./pages/admi_curses.html" // Enlace a admin_curses.html
        }
        // Ejemplo de otra tarjeta:
        // {
        //     title: "Reportes",
        //     description: "Ver estadísticas y reportes de avance.",
        //     icon: "fas fa-chart-line",
        //     link: "./admin_reports.html"
        // }
    ];

    function renderCards() {
        const container = document.getElementById('card-container');
        if (!container) return;
        
        let html = '';
        
        adminCards.forEach(card => {
            html += `
            <a href="${card.link}" class="admin-card">
                <div class="card-icon">
                    <i class="${card.icon}"></i>
                </div>
                <div class="card-content">
                    <h2>${card.title}</h2>
                    <p>${card.description}</p>
                </div>
                <div class="card-footer">
                    <span>Ir a gestionar</span>
                    <i class="fas fa-arrow-right"></i>
                </div>
            </a>
            `;
        });
        
        container.innerHTML = html;
    }

    // =================================================================
    // LÓGICA DEL TENANT (Copiada de admin.html)
    // =================================================================
    
    // Función para establecer variables CSS
    const setStyle = (prop, value) => {
        if (value) document.documentElement.style.setProperty(prop, value);
    };

    // Función para detectar el tenant desde el hostname
    const detectTenant = () => {
        const host = location.hostname || 'localhost';
        if (host === 'localhost') return 'demo';
        if (host === '127.0.0.1') return 'default';
        const parts = host.split('.');
        if (parts.length > 2 && parts[0] !== 'www') return parts[0];
        return 'default';
    };

    // Función para cargar la configuración del tenant (JSON y Supabase)
    async function loadTenantConfig() {
        const tenantId = detectTenant();
        try {
            // 1. Cargar desde JSON
            const response = await fetch('../tenants/tenants.json', { cache: 'no-store' });
            if (!response.ok) throw new Error('No se pudo cargar tenants.json');
            const data = await response.json();
            const config = data[tenantId] || data['default'] || {};
            
            // 2. (Opcional) Cargar UUID desde Supabase si se necesita
            // Si esta página no necesita el UUID, puedes comentar esta parte
            // const { data: tenantDB, error } = await supabase
            //     .from('tenants')
            //     .select('id')
            //     .eq('name', tenantId)
            //     .single();
            
            // if (error) throw new Error(`Tenant '${tenantId}' no encontrado en BD.`);
            // config.tenantUUID = tenantDB.id;
            
            return config;
        } catch (error) {
            console.warn('⚠️ Error al cargar configuración del tenant:', error.message);
            return {}; // Devuelve config vacía para no fallar
        }
    }

    // Función para aplicar la configuración visual
    function applyConfiguration(config) {
        setStyle('--primaryColor', config.primaryColor);
        setStyle('--secondaryColor', config.secondaryColor);
        
        // Actualiza el nombre de la compañía si existe
        const companyNameEl = document.getElementById('companyName');
        if (companyNameEl && config.companyName) {
            const icon = companyNameEl.querySelector('i');
            companyNameEl.innerHTML = ''; // Limpia
            if (icon) companyNameEl.appendChild(icon); // Restaura el icono
            companyNameEl.appendChild(document.createTextNode(` ${config.companyName} Admin`));
        }
    }

    // =================================================================
    // ARRANQUE DE LA PÁGINA
    // =================================================================
    
    async function mainInit() {
        // 1. Cargar y aplicar colores del Tenant
        const config = await loadTenantConfig();
        applyConfiguration(config);
        
        // 2. Dibujar las tarjetas de administración
        renderCards();

        // 3. FIX: Hacer visible el cuerpo de la página
        document.body.style.opacity = 1;
    }

    // Disparador de Carga
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', mainInit);
    } else {
        mainInit();
    }

</script>

</body>
</html>