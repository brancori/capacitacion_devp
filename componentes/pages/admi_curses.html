<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Administración de Cursos</title>
    
    <!-- 1. Estilos Globales (Subimos un nivel) -->
    <link rel="stylesheet" href="../../componentes/global.css?v=6">
    
    <!-- 2. Estilos Específicos (Mismo nivel) -->
    <link rel="stylesheet" href="./admi_curses.css?v=6.7">
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Supabase Client (Subimos un nivel) -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="../../componentes/supabase-client.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx-js-style@1.2.0/dist/xlsx.bundle.js"></script>

</head>
<body>
    <!-- Header -->
        <nav class="top-navbar">
            <div class="logo-section">
                <h2 id="companyName"><i class="fas fa-graduation-cap"></i> TROX Academy</h2>
            </div>
            <div class="nav-actions">
                <!-- INDICADOR DE CUMPLIMIENTO -->
                <div style="display:flex; align-items:center; gap:0.5rem; margin-right:1.5rem;">
                    <div id="compliance-badge" class="compliance-badge">
                        <span class="dot"></span>
                        <span id="compliance-text">Cumplimiento: <span id="compliance-value">0%</span></span>
                    </div>
                </div>
                <!-- FIN INDICADOR -->
                <div class="navbar-a">
                    <a href="../../profile/profile.html" class="btn btn-outline">
                        <i class="fas fa-user"></i> Mi Perfil
                    </a>
                    <a href="../../index.html" class="btn btn-outline">
                        <i class="fas fa-sign-out-alt"></i> Salir
                    </a>
                </div>
            </div>
        </nav>

<!-- Main Container -->
<div class="container">
    <!-- KPI Dashboard -->
    <div class="kpi-container">
        <div class="kpi-card">
            <div class="kpi-icon"><i class="fas fa-check-circle"></i></div>
            <div class="kpi-content">
                <div class="kpi-value" id="kpi-completed">--</div>
                <div class="kpi-label">Completado</div>
            </div>
        </div>
        <div class="kpi-card">
            <div class="kpi-icon"><i class="fas fa-spinner"></i></div>
            <div class="kpi-content">
                <div class="kpi-value" id="kpi-active">--</div>
                <div class="kpi-label">En Progreso</div>
            </div>
        </div>
        <div class="kpi-card">
            <div class="kpi-icon"><i class="fas fa-exclamation-triangle"></i></div>
            <div class="kpi-content">
                <div class="kpi-value" id="kpi-expired">--</div>
                <div class="kpi-label">Vencidos</div>
            </div>
        </div>
        <div class="kpi-card">
            <div class="kpi-icon"><i class="fas fa-bolt"></i></div>
            <div class="kpi-content">
                <div class="kpi-value" id="kpi-urgent">--</div>
                <div class="kpi-label">Urgentes</div>
            </div>
        </div>
    </div>
    <div class="main-tabs">
        <button class="main-tab active" onclick="switchMainTab('groups')" data-maintab="groups">
            <i class="fas fa-layer-group"></i> Grupos
        </button>
        <button class="main-tab" onclick="switchMainTab('tracking')" data-maintab="tracking">
            <i class="fas fa-clipboard-list"></i> Seguimiento de Usuarios
        </button>
    </div>
    <!-- Main View -->
    <div id="main-view">
        <!-- Controls -->
        <div class="controls">
            <div class="search-box">
                <span class="search-icon"><i class="fas fa-search"></i></span>
                <input type="text" class="search-input" id="search-groups" placeholder="    Buscar grupos...">
            </div>
            <button class="btn btn-primary" onclick="openNewGroupModal()">
                <span><i class="fas fa-plus"></i></span> Nuevo Grupo
            </button>
        </div>

        <!-- Groups Grid -->
        <div class="groups-grid" id="groups-container">
            <div class="empty-state">
                <i class="fas fa-spinner fa-spin empty-state-icon"></i>
                <p>Cargando grupos...</p>
            </div>
        </div>
    </div>


    <!-- Tracking View -->
    <div id="tracking-view" style="display:none;">
        <div class="tracking-header">
            <div class="tracking-filters">
                <div class="search-box">
                    <span class="search-icon"><i class="fas fa-search"></i></span>
                    <input type="text" class="search-input" id="search-users-tracking" placeholder="Buscar usuario...">
                </div>
                <select id="filter-status" class="form-control" style="width:auto;">
                    <option value="all">Todos los estados</option>
                    <option value="completed">Solo Completados</option>
                    <option value="in_progress">Solo En Progreso</option>
                    <option value="expired">Solo Vencidos</option>
                </select>
            </div>
            <button class="btn btn-primary" onclick="exportToExcel()">
                <i class="fas fa-file-excel"></i> Exportar Excel
            </button>
        </div>
        
        <div class="tracking-table-container">
            <table class="tracking-table" id="tracking-table">
                <thead>
                    <tr>
                        <th>Usuario</th>
                        <th>Email</th>
                        <th class="text-center">Completados</th>
                        <th class="text-center">En Progreso</th>
                        <th class="text-center">Vencidos</th>
                        <th class="text-center">% Cumplimiento</th>
                        <th></th>
                    </tr>
                </thead>
                <tbody id="tracking-tbody"></tbody>
            </table>
        </div>
    </div>

    <!-- Detail View -->
    <div id="detail-view" class="detail-view">
        <div class="detail-header">
            <button class="back-btn" onclick="backToMain()">
                <i class="fas fa-arrow-left"></i> Volver a Grupos
            </button>
            <h2 id="detail-group-name" style="margin-top: 1rem;"></h2>
            <div class="group-meta" id="detail-group-meta"></div>
        </div>
        
        <div class="detail-content-wrapper">
            <div class="tabs">
                <button class="tab active" onclick="switchTab('users')" data-tab="users"><i class="fas fa-users"></i> Miembros</button>
                <button class="tab" onclick="switchTab('courses')" data-tab="courses"><i class="fas fa-book"></i> Cursos Asignados</button>
            </div>

            <!-- Tab Miembros -->
        <div id="tab-users" class="tab-content">
            <div class="two-column">
                <div>
                    <div class="column-title">DISPONIBLES PARA AGREGAR</div>
                    <div class="search-box" style="margin-bottom: 0.5rem;">
                        <span class="search-icon"><i class="fas fa-search"></i></span>
                        <input type="text" class="search-input" id="search-available" placeholder="Filtrar disponibles...">
                    </div>
                    <div class="course-list" id="available-users-list"></div>
                </div>
                <div>
                    <div class="column-title">MIEMBROS DEL GRUPO (<span id="members-count">0</span>)</div>
                    <div id="users-list"></div>
                </div>
            </div>
        </div>

            <!-- Tab Cursos -->
            <div id="tab-courses" class="tab-content" style="display: none;">
                <div id="courses-list"></div>
                <button class="btn btn-primary" style="margin-top: 1rem;" onclick="openAssignModal()">
                    ➕ Asignar Nuevos Cursos al Grupo
                </button>
            </div>
        </div>
    </div>
</div>

<div class="toast-container" id="toast-container"></div>

<!-- Assign Courses Modal -->
<div class="modal" id="assign-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title" id="modal-title">Asignar Cursos</h3>
            <button class="modal-close" onclick="closeAssignModal()">✕</button>
        </div>
        <div class="modal-body">
            <div class="search-box" style="margin-bottom: 1rem;">
                <span class="search-icon"><i class="fas fa-search"></i></span>
                <input type="text" class="search-input" id="search-catalog" placeholder="Buscar en catálogo...">
            </div>

            <div class="two-column">
                <div>
                    <div class="column-title">CATÁLOGO DE CURSOS</div>
                    <div class="course-list" id="catalog-list"></div>
                </div>
                <div>
                    <div class="column-title">SELECCIONADOS (<span id="selected-count">0</span>)</div>
                    <div id="selected-list"></div>
                </div>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-outline" onclick="closeAssignModal()">Cancelar</button>
            <button class="btn btn-primary" onclick="confirmAssignment()">Asignar Cursos →</button>
        </div>
    </div>
</div>

<!-- User Detail Modal -->
<div class="modal user-detail-modal" id="user-detail-modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 id="user-detail-name">Detalle del Usuario</h3>
            <button class="modal-close" onclick="closeUserDetailModal()">✕</button>
        </div>
        <div class="modal-body">
            <div class="user-summary" id="user-summary"></div>
            <div id="user-courses-container"></div>
        </div>
        <div class="modal-footer">
            <button class="btn btn-outline" onclick="closeUserDetailModal()">Cerrar</button>
            <button class="btn btn-primary" onclick="sendReminder()">
                <i class="fas fa-bell"></i> Enviar Recordatorio
            </button>
        </div>
    </div>
</div>

<script src="./admi_curses.js?v=5"></script>
</body>
</html>