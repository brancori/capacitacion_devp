<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mi Perfil de CapacitaciÃ³n PRO</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="../componentes/global.css">
    <link rel="stylesheet" href="./profile.css">
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>

    <!-- Top Navigation -->
    <nav class="top-navbar">
        <div class="logo-section">
            <h2 id="companyName"><i class="fas fa-graduation-cap"></i> TROX Academy</h2>
        </div>
        <div class="nav-actions">

            <button class="notification-btn" id="notificationBtn">
                <i class="fas fa-bell"></i>
                <span class="notification-badge">3</span>
            </button>
            <button class="theme-toggle" id="themeToggle">
                <i class="fas fa-moon"></i>
            </button>
            <!-- CORRECCIÃ“N: Cambiado de <button> a <a> para el enlace -->
            <a href="../index.html" class="btn btn-outline">
                <i class="fas fa-sign-out-alt"></i> Salir
            </a>
        </div>
    </nav>

    <div class="container">
        <!-- 'stats-grid' se moviÃ³ dentro de 'content-area' -->

        <!-- Main Grid -->
        <div class="main-grid">
            <!-- Sidebar -->
            <div class="sidebar">
                <!-- Profile Card -->
                <div class="profile-card">
                    <div class="avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <h2 id="profileName">Cargando...</h2>
                    <p class="role">Contratista | ID: 789456</p>
                    
                    <div class="progress-donut">
                        <svg viewBox="0 0 150 150">
                            <circle class="progress-donut-bg" cx="75" cy="75" r="69"></circle>
                            <circle class="progress-donut-fg" cx="75" cy="75" r="69"></circle>
                        </svg>
                        <span class="progress-text">40%</span>
                    </div>
                    <p style="color: var(--primary); font-weight: 600; margin-bottom: 1rem;">
                        2 de 5 cursos completados
                    </p>
                    <button class="btn btn-primary" style="width: 100%;">
                        <i class="fas fa-user-edit"></i> Editar Perfil
                    </button>
                    <a href="../componentes/admin.html" class="btn btn-outline" id="manageUsersBtn" style="width: 100%; margin-top: 0.75rem; display: none;">
                        <i class="fas fa-users-cog"></i> AdminsitraciÃ³n<nav></nav>
                    </a>
                </div>

                <!-- Badges Card -->
                <div class="badges-card">
                    <h3><i class="fas fa-trophy"></i> Certificaciones</h3>
                    <div class="badges-grid">
                        <div class="badge earned" title="CertificaciÃ³n Obtenida">
                            <i class="fas fa-first-aid"></i>
                            <span>Brigadista P. Auxilios Leader</span>
                        </div>
                        <div class="badge" title="Requiere: Curso de Primeros Auxilios Avanzado">
                            <i class="fas fa-fire-extinguisher"></i>
                            <span>Combate Incendios Leader</span>
                        </div>
                        <div class="badge" title="Requiere: 3 cursos de calidad completados">
                            <i class="fas fa-certificate"></i>
                            <span>Quality Expert</span>
                        </div>
                        <div class="badge" title="Requiere: Curso de Trabajos en Altura BÃ¡sico">
                            <i class="fas fa-hard-hat"></i>
                            <span>Alturas Instructor</span>
                        </div>
                        <div class="badge" title="Requiere: Alturas BÃ¡sico + Intermedio + Rescate">
                            <i class="fas fa-mountain"></i>
                            <span>Espacios Confinados Instructor</span>
                        </div>
                        <div class="badge" title="Requiere: 10+ certificaciones profesionales">
                            <i class="fas fa-crown"></i>
                            <span>LÃ­der HSE</span>
                        </div>
                    </div>
                    <button class="btn btn-outline" id="viewBadgesBtn" style="width: 100%; margin-top: 1rem; font-size: 0.9rem;">
                        <i class="fas fa-info-circle"></i> Ver Requisitos
                    </button>
                </div>

                <!-- Calendar Card -->
                <div class="calendar-card">
                    <h3><i class="far fa-calendar-alt"></i> PrÃ³ximos Vencimientos</h3>
                    <div class="calendar-event urgent">
                        <div class="event-date">
                            <div class="day">30</div>
                            <div class="month">OCT</div>
                        </div>
                        <div class="event-details">
                            <h4>InducciÃ³n de Seguridad</h4>
                            <p>Vence en 3 dÃ­as</p>
                        </div>
                    </div>
                    <div class="calendar-event">
                        <div class="event-date">
                            <div class="day">26</div>
                            <div class="month">NOV</div>
                        </div>
                        <div class="event-details">
                            <h4>Manejo de QuÃ­micos</h4>
                            <p>Vence en 30 dÃ­as</p>
                        </div>
                    </div>
                    <div class="calendar-event">
                        <div class="event-date">
                            <div class="day">26</div>
                            <div class="month">DIC</div>
                        </div>
                        <div class="event-details">
                            <h4>Uso de Extintores</h4>
                            <p>Vence en 60 dÃ­as</p>
                        </div>
                    </div>
                </div>
            </div> <!-- Cierre de .sidebar -->

            <!-- Main Content -->
            <div class="content-area">
                
                <!-- CORRECCIÃ“N: 'stats-grid' movido aquÃ­ dentro -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon total">
                            <i class="fas fa-book"></i>
                        </div>
                        <div class="stat-content">
                            <h3>5</h3>
                            <p>Cursos Totales</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon completed">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="stat-content">
                            <h3>2</h3>
                            <p>Completados</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon pending">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-content">
                            <h3>2</h3>
                            <p>En Progreso</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon urgent">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="stat-content">
                            <h3>1</h3>
                            <p>Urgente</p>
                        </div>
                    </div>
                </div>

                <!-- Filter Bar -->
                <div class="filter-bar">
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" id="searchInput" placeholder="Buscar cursos...">
                    </div>
                    <div class="filter-group">
                        <button class="filter-btn active" data-filter="all">Todos</button>
                        <button class="filter-btn" data-filter="urgent">Urgente</button>
                        <button class="filter-btn" data-filter="pending">Pendiente</button>
                        <button class="filter-btn" data-filter="completed">Completado</button>
                    </div>
                </div>

                <!-- Tabs -->
                <div class="tabs">
                    <div class="tab active" data-tab="assigned">
                        <i class="fas fa-tasks"></i> Asignados
                    </div>
                    <div class="tab" data-tab="certificates">
                        <i class="fas fa-certificate"></i> Certificados
                    </div>
                    <div class="tab" data-tab="catalog">
                        <i class="fas fa-search-plus"></i> Explorar
                    </div>
                    <div class="tab" data-tab="timeline">
                        <i class="fas fa-history"></i> Historial
                    </div>
                    <div class="tab" data-tab="recommendations">
                        <i class="fas fa-lightbulb"></i> Sugerencias
                    </div>
                </div>

                <!-- Tab Content: Assigned Courses -->
                <div class="tab-content active" id="assigned">
                    <div class="course-grid">
                        <!-- Course 1: Urgent -->
                        <div class="course-card" data-status="urgent">
                            <div class="course-icon-lg urgent">
                                <i class="fas fa-exclamation-triangle"></i>
                            </div>
                            <div class="course-info">
                                <h3>InducciÃ³n de Seguridad (Contratistas)</h3>
                                <p style="color: var(--danger); font-weight: 600; margin-bottom: 0.5rem;">
                                    <i class="fas fa-clock"></i> Vence en 3 dÃ­as
                                </p>
                                <div class="course-meta">
                                    <span class="meta-item">
                                        <i class="fas fa-user"></i> Capacitador: Ing. GarcÃ­a
                                    </span>
                                    <span class="meta-item">
                                        <i class="fas fa-hourglass-half"></i> 2 horas
                                    </span>
                                </div>
                                <div class="progress-bar-container">
                                    <div class="progress-bar-fill" style="width: 60%"></div>
                                </div>
                                <p style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 0.5rem;">
                                    Progreso: 60% completado
                                </p>
                            </div>
                            <div class="course-actions">
                                <a href="#" class="btn btn-primary">
                                    <i class="fas fa-play"></i> Continuar
                                </a>
                                <button class="btn btn-outline btn-reminder" data-course="InducciÃ³n de Seguridad">
                                    <i class="fas fa-bell"></i> Recordar
                                </button>
                            </div>
                        </div>

                        <!-- Course 2: Pending -->
                        <div class="course-card" data-status="pending">
                            <div class="course-icon-lg pending">
                                <i class="fas fa-flask"></i>
                            </div>
                            <div class="course-info">
                                <h3>Manejo de Sustancias QuÃ­micas</h3>
                                <p style="color: var(--warning); font-weight: 600; margin-bottom: 0.5rem;">
                                    <i class="fas fa-calendar"></i> Vence en 30 dÃ­as
                                </p>
                                <div class="course-meta">
                                    <span class="meta-item">
                                        <i class="fas fa-user"></i> Capacitador: Dra. MartÃ­nez
                                    </span>
                                    <span class="meta-item">
                                        <i class="fas fa-hourglass-half"></i> 3 horas
                                    </span>
                                </div>
                                <div class="progress-bar-container">
                                    <div class="progress-bar-fill" style="width: 25%"></div>
                                </div>
                                <p style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 0.5rem;">
                                    Progreso: 25% completado
                                </p>
                            </div>
                            <div class="course-actions">
                                <a href="#" class="btn btn-primary">
                                    <i class="fas fa-play"></i> Continuar
                                </a>
                                <button class="btn btn-outline btn-reminder" data-course="Manejo de Sustancias QuÃ­micas">
                                    <i class="fas fa-bell"></i> Recordar
                                </button>
                            </div>
                        </div>

                        <!-- Course 3: Pending -->
                        <div class="course-card" data-status="pending">
                            <div class="course-icon-lg pending">
                                <i class="fas fa-fire-extinguisher"></i>
                            </div>
                            <div class="course-info">
                                <h3>Uso de Extintores Nivel 1</h3>
                                <p style="color: var(--warning); font-weight: 600; margin-bottom: 0.5rem;">
                                    <i class="fas fa-calendar"></i> Vence en 60 dÃ­as
                                </p>
                                <div class="course-meta">
                                    <span class="meta-item">
                                        <i class="fas fa-user"></i> Capacitador: Ing. LÃ³pez
                                    </span>
                                    <span class="meta-item">
                                        <i class="fas fa-hourglass-half"></i> 1.5 horas
                                    </span>
                                </div>
                                <div class="progress-bar-container">
                                    <div class="progress-bar-fill" style="width: 0%"></div>
                                </div>
                                <p style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 0.5rem;">
                                    No iniciado
                                </p>
                            </div>
                            <div class="course-actions">
                                <a href="#" class="btn btn-primary">
                                    <i class="fas fa-play"></i> Empezar
                                </a>
                                <button class="btn btn-outline btn-reminder" data-course="Uso de Extintores Nivel 1">
                                    <i class="fas fa-bell"></i> Recordar
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tab Content: Certificates -->
                <div class="tab-content" id="certificates">
                    <div class="course-grid">
                        <!-- Certificate 1 -->
                        <div class="course-card" data-status="completed">
                            <div class="course-icon-lg completed">
                                <i class="fas fa-certificate"></i>
                            </div>
                            <div class="course-info">
                                <h3>PolÃ­tica de Seguridad TROX</h3>
                                <p style="color: var(--success); font-weight: 600; margin-bottom: 0.5rem;">
                                    <i class="fas fa-check-circle"></i> Completado el 15/10/2025
                                </p>
                                <div class="course-meta">
                                    <span class="meta-item">
                                        <i class="fas fa-star"></i> CalificaciÃ³n: 95/100
                                    </span>
                                    <span class="meta-item">
                                        <i class="fas fa-trophy"></i> Certificado #TRX-2025-001
                                    </span>
                                </div>
                            </div>
                            <div class="course-actions">
                                <button class="btn btn-primary btn-download" data-cert="PolÃ­tica de Seguridad TROX">
                                    <i class="fas fa-download"></i> Descargar PDF
                                </button>
                                <button class="btn btn-outline">
                                    <i class="fas fa-share-alt"></i> Compartir
                                </button>
                            </div>
                        </div>

                        <!-- Certificate 2 -->
                        <div class="course-card" data-status="completed">
                            <div class="course-icon-lg completed">
                                <i class="fas fa-certificate"></i>
                            </div>
                            <div class="course-info">
                                <h3>COVID-19: Protocolo de Acceso</h3>
                                <p style="color: var(--success); font-weight: 600; margin-bottom: 0.5rem;">
                                    <i class="fas fa-check-circle"></i> Completado el 01/09/2025
                                </p>
                                <div class="course-meta">
                                    <span class="meta-item">
                                        <i class="fas fa-star"></i> CalificaciÃ³n: 100/100
                                    </span>
                                    <span class="meta-item">
                                        <i class="fas fa-trophy"></i> Certificado #TRX-2025-002
                                    </span>
                                </div>
                            </div>
                            <div class="course-actions">
                                <button class="btn btn-primary btn-download" data-cert="COVID-19: Protocolo de Acceso">
                                    <i class="fas fa-download"></i> Descargar PDF
                                </button>
                                <button class="btn btn-outline">
                                    <i class="fas fa-share-alt"></i> Compartir
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tab Content: Catalog -->
                <div class="tab-content" id="catalog">
                    <div class="course-grid">
                        <!-- Catalog Course 1 -->
                        <div class="course-card">
                            <div class="course-icon-lg catalog">
                                <i class="fas fa-first-aid"></i>
                            </div>
                            <div class="course-info">
                                <h3>Brigada de Primeros Auxilios</h3>
                                <p style="color: var(--text-secondary); margin-bottom: 0.5rem;">
                                    Curso voluntario de especializaciÃ³n
                                </p>
                                <div class="course-meta">
                                    <span class="meta-item">
                                        <i class="fas fa-hourglass-half"></i> 8 horas
                                    </span>
                                    <span class="meta-item">
                                        <i class="fas fa-users"></i> 45 inscritos
                                    </span>
                                    <span class="meta-item">
                                        <i class="fas fa-star"></i> 4.8/5
                                    </span>
                                </div>
                            </div>
                            <div class="course-actions">
                                <button class="btn btn-success btn-enroll" data-course="Brigada de Primeros Auxilios">
                                    <i class="fas fa-plus-circle"></i> Inscribirme
                                </button>
                                <button class="btn btn-outline">
                                    <i class="fas fa-info-circle"></i> MÃ¡s info
                                </button>
                            </div>
                        </div>

                        <!-- Catalog Course 2 -->
                        <div class="course-card">
                            <div class="course-icon-lg catalog">
                                <i class="fas fa-search"></i>
                            </div>
                            <div class="course-info">
                                <h3>Brigada de BÃºsqueda y Rescate</h3>
                                <p style="color: var(--text-secondary); margin-bottom: 0.5rem;">
                                    Curso avanzado de respuesta emergencias
                                </p>
                                <div class="course-meta">
                                    <span class="meta-item">
                                        <i class="fas fa-hourglass-half"></i> 12 horas
                                    </span>
                                    <span class="meta-item">
                                        <i class="fas fa-users"></i> 32 inscritos
                                    </span>
                                    <span class="meta-item">
                                        <i class="fas fa-star"></i> 4.9/5
                                    </span>
                                </div>
                            </div>
                            <div class="course-actions">
                                <button class="btn btn-success btn-enroll" data-course="Brigada de BÃºsqueda y Rescate">
                                    <i class="fas fa-plus-circle"></i> Inscribirme
                                </button>
                                <button class="btn btn-outline">
                                    <i class="fas fa-info-circle"></i> MÃ¡s info
                                </button>
                            </div>
                        </div>
                        
                        <!-- Catalog Course 3 (Estaba fuera) -->
                        <div class="course-card">
                            <div class="course-icon-lg catalog">
                                <i class="fas fa-recycle"></i>
                            </div>
                            <div class="course-info">
                                <h3>GestiÃ³n Ambiental y Reciclaje</h3>
                                <p style="color: var(--text-secondary); margin-bottom: 0.5rem;">
                                    Curso de sostenibilidad corporativa
                                </p>
                                <div class="course-meta">
                                    <span class="meta-item">
                                        <i class="fas fa-hourglass-half"></i> 2 horas
                                    </span>
                                    <span class="meta-item">
                                        <i class="fas fa-users"></i> 78 inscritos
                                    </span>
                                    <span class="meta-item">
                                        <i class="fas fa-star"></i> 4.7/5
                                    </span>
                                </div>
                            </div>
                            <div class="course-actions">
                                <button class="btn btn-success btn-enroll" data-course="GestiÃ³n Ambiental y Reciclaje">
                                    <i class="fas fa-plus-circle"></i> Inscribirme
                                </button>
                                <button class="btn btn-outline">
                                    <i class="fas fa-info-circle"></i> MÃ¡s info
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tab Content: Timeline (Estaba fuera) -->
                <div class="tab-content" id="timeline">
                    <div class="timeline">
                        <div class="timeline-item">
                            <div class="timeline-content">
                                <div class="timeline-date">15 de Octubre, 2025</div>
                                <h3 style="color: var(--success); margin-bottom: 0.5rem;">
                                    <i class="fas fa-check-circle"></i> Curso Completado
                                </h3>
                                <p><strong>PolÃ­tica de Seguridad TROX</strong></p>
                                <p style="color: var(--text-secondary); font-size: 0.9rem;">
                                    CalificaciÃ³n obtenida: 95/100 | Certificado emitido
                                </p>
                            </div>
                        </div>

                        <div class="timeline-item">
                            <div class="timeline-content">
                                <div class="timeline-date">10 de Octubre, 2025</div>
                                <h3 style="color: var(--warning); margin-bottom: 0.5rem;">
                                    <i class="fas fa-play-circle"></i> Curso Iniciado
                                </h3>
                                <p><strong>InducciÃ³n de Seguridad (Contratistas)</strong></p>
                                <p style="color: var(--text-secondary); font-size: 0.9rem;">
                                    En progreso: 60% completado
                                </p>
                            </div>
                        </div>

                        <div class="timeline-item">
                            <div class="timeline-content">
                                <div class="timeline-date">1 de Septiembre, 2025</div>
                                <h3 style="color: var(--success); margin-bottom: 0.5rem;">
                                    <i class="fas fa-check-circle"></i> Curso Completado
                                </h3>
                                <p><strong>COVID-19: Protocolo de Acceso</strong></p>
                                <p style="color: var(--text-secondary); font-size: 0.9rem;">
                                    CalificaciÃ³n obtenida: 100/100 | Certificado emitido
                                </p>
                            </div>
                        </div>

                        <div class="timeline-item">
                            <div class="timeline-content">
                                <div class="timeline-date">25 de Agosto, 2025</div>
                                <h3 style="color: var(--primary); margin-bottom: 0.5rem;">
                                    <i class="fas fa-user-plus"></i> Registro en Plataforma
                                </h3>
                                <p><strong>Bienvenido a TROX Academy</strong></p>
                                <p style="color: var(--text-secondary); font-size: 0.9rem;">
                                    Tu cuenta ha sido activada correctamente
                                </p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tab Content: Recommendations (Estaba fuera) -->
                <div class="tab-content" id="recommendations">
                    <h2 style="margin-bottom: 1rem; color: var(--primary);">
                        <i class="fas fa-magic"></i> Cursos Recomendados Para Ti
                    </h2>
                    <p style="color: var(--text-secondary); margin-bottom: 2rem;">
                        Basado en tu perfil, historial y cursos completados
                    </p>
                    
                    <div class="recommendations-grid">
                        <!-- Recommendation 1 -->
                        <div class="recommendation-card">
                            <div class="rec-header">
                                <div class="rec-icon">
                                    <i class="fas fa-hard-hat"></i>
                                </div>
                                <div>
                                    <h3 style="margin-bottom: 0.25rem;">Seguridad en Alturas</h3>
                                    <p style="font-size: 0.85rem; color: var(--text-secondary);">
                                        Nivel Intermedio
                                    </p>
                                </div>
                                <span class="match-score">92%</span>
                            </div>
                            <p style="color: var(--text-secondary); margin-bottom: 1rem; font-size: 0.9rem;">
                                ContinuaciÃ³n ideal despuÃ©s de completar InducciÃ³n de Seguridad
                            </p>
                            <div style="display: flex; gap: 0.5rem; margin-bottom: 1rem; flex-wrap: wrap;">
                                <span style="background: #e6f0ff; color: var(--primary); padding: 0.25rem 0.75rem; border-radius: 15px; font-size: 0.8rem;">
                                    6 horas
                                </span>
                                <span style="background: #e6f0ff; color: var(--primary); padding: 0.25rem 0.75rem; border-radius: 15px; font-size: 0.8rem;">
                                    CertificaciÃ³n
                                </span>
                            </div>
                            <button class="btn btn-success btn-enroll" data-course="Seguridad en Alturas" style="width: 100%;">
                                <i class="fas fa-plus-circle"></i> Inscribirme
                            </button>
                        </div>

                        <!-- Recommendation 2 -->
                        <div class="recommendation-card">
                            <div class="rec-header">
                                <div class="rec-icon">
                                    <i class="fas fa-shield-alt"></i>
                                </div>
                                <div>
                                    <h3 style="margin-bottom: 0.25rem;">EPP Avanzado</h3>
                                    <p style="font-size: 0.85rem; color: var(--text-secondary);">
                                        Nivel Avanzado
                                    </p>
                                </div>
                                <span class="match-score">88%</span>
                            </div>
                            <p style="color: var(--text-secondary); margin-bottom: 1rem; font-size: 0.9rem;">
                                EspecializaciÃ³ncomplementaria a tus cursos actuales
                            </p>
                            <div style="display: flex; gap: 0.5rem; margin-bottom: 1rem; flex-wrap: wrap;">
                                <span style="background: #e6f0ff; color: var(--primary); padding: 0.25rem 0.75rem; border-radius: 15px; font-size: 0.8rem;">
                                    4 horas
                                </span>
                                <span style="background: #e6f0ff; color: var(--primary); padding: 0.25rem 0.75rem; border-radius: 15px; font-size: 0.8rem;">
                                    PrÃ¡ctico
                                </span>
                            </div>
                            <button class="btn btn-success btn-enroll" data-course="EPP Avanzado" style="width: 100%;">
                                <i class="fas fa-plus-circle"></i> Inscribirme
                            </button>
                        </div>

                        <!-- Recommendation 3 -->
                        <div class="recommendation-card">
                            <div class="rec-header">
                                <div class="rec-icon">
                                    <i class="fas fa-bolt"></i>
                                </div>
                                <div>
                                    <h3 style="margin-bottom: 0.25rem;">Riesgo ElÃ©ctrico</h3>
                                    <p style="font-size: 0.85rem; color: var(--text-secondary);">
                                        Nivel BÃ¡sico
                                    </p>
                                </div>
                                <span class="match-score">85%</span>
                            </div>
                            <p style="color: var(--text-secondary); margin-bottom: 1rem; font-size: 0.9rem;">
                                Muy solicitado en tu Ã¡rea de trabajo
                            </p>
                            <div style="display: flex; gap: 0.5rem; margin-bottom: 1rem; flex-wrap: wrap;">
                                <span style="background: #e6f0ff; color: var(--primary); padding: 0.25rem 0.75rem; border-radius: 15px; font-size: 0.8rem;">
                                    3 horas
                                </span>
                                <span style="background: #e6f0ff; color: var(--primary); padding: 0.25rem 0.75rem; border-radius: 15px; font-size: 0.8rem;">
                                    Popular
                                </span>
                            </div>
                            <button class="btn btn-success btn-enroll" data-course="Riesgo ElÃ©ctrico" style="width: 100%;">
                                <i class="fas fa-plus-circle"></i> Inscribirme
                            </button>
                        </div>
                    </div>
                </div>
            </div> <!-- Cierre de .content-area -->
        </div> <!-- Cierre de .main-grid -->
    </div> <!-- Cierre de .container -->

    <!-- Modal (Estaba fuera) -->
    <div class="modal" id="modal">
        <div class="modal-content">
            <div class="modal-icon" id="modalIcon"></div>
            <h3 id="modalTitle"></h3>
            <p id="modalMessage"></p>
            <button class="btn btn-primary" id="modalClose" style="width: 100%;">Aceptar</button>
        </div>
    </div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// BLOQUE ÃšNICO DE INICIALIZACIÃ“N
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
(async () => {

Â  // --- LÃ³gica del Tenant (Tu cÃ³digo original) ---
Â  const setStyle = (prop, value) => {
Â  Â  if (value) document.documentElement.style.setProperty(prop, value);
Â  };

Â  const detectTenant = () => {
Â  Â  const host = location.hostname || 'localhost';

Â  Â  if (host === 'localhost') {
Â  Â  Â  return 'demo';
Â  Â  }
Â  Â  if (host === '127.0.0.1') {
Â  Â  Â  return 'default';
Â  Â  }
Â  Â  const parts = host.split('.');
Â  Â  
Â  Â  if (parts.length > 2 && parts[0] !== 'www') {
Â  Â  Â  return parts[0];
Â  Â  }
Â  Â  
Â  Â  return 'default';
Â  };

Â  async function loadTenantConfig() {
Â  Â  const tenantId = detectTenant();
Â  Â  console.log(`ğŸ” Detectando tenant: ${tenantId}`);
Â  Â  try {
Â  Â  Â  const response = await fetch('../tenants/tenants.json', {
Â  Â  Â  Â  cache: 'no-store',
Â  Â  Â  Â  headers: { 'Accept': 'application/json' }
Â  Â  Â  });
Â  Â  Â  if (!response.ok) throw new Error('No se pudo cargar tenants.json');
Â  Â  Â  const data = await response.json();
Â  Â  Â  return data[tenantId] || data['default'] || {};
Â  Â  } catch (error) {
Â  Â  Â  console.warn('âš ï¸ Error al cargar configuraciÃ³n del tenant:', error);
Â  Â  Â  return {};
Â  Â  }
Â  }

Â  function applyConfiguration(config) {
Â  Â  if (!config) return;
Â  Â  
Â  Â  // Colores
Â  Â  setStyle('--primaryColor', config.primaryColor);
Â  Â  setStyle('--secondaryColor', config.secondaryColor);

Â  Â  // Nombre de la compaÃ±Ã­a
Â  Â  const companyNameEl = document.getElementById('companyName');
Â  Â  if (companyNameEl && config.companyName) {
Â  Â  Â  const icon = companyNameEl.querySelector('i');
Â  Â  Â  companyNameEl.innerHTML = '';
Â  Â  Â  if (icon) companyNameEl.appendChild(icon);
Â  Â  Â  companyNameEl.appendChild(document.createTextNode(` ${config.companyName}`));
Â  Â  }
Â  Â  console.log(`ğŸ¨ Tenant aplicado: ${config.companyName || 'sin nombre definido'}`);
Â  }

Â  // --- LÃ³gica de Permisos (NUEVA) ---
Â  const manageUsersBtn = document.getElementById('manageUsersBtn');

Â  /**
Â  Â * Muestra u oculta elementos basados en el rol del usuario.
Â  Â */
Â  function updateProfileView(profile) {
Â  Â  // Actualizar el nombre
Â  Â  const profileNameEl = document.getElementById('profileName');
Â  Â  if (profileNameEl) {
      // *** CORREGIDO ***
Â  Â  Â  profileNameEl.textContent = profile.full_name || 'Usuario';
Â  Â  }

Â  Â  // LÃ³gica de permisos existente
    // *** CORREGIDO (para incluir 'supervisor') ***
    const allowedRoles = ['master', 'admin', 'supervisor'];
Â  Â  if (allowedRoles.includes(profile.role)) {
Â  Â  Â  if (manageUsersBtn) manageUsersBtn.style.display = 'flex';
Â  Â  } else {
Â  Â  Â  if (manageUsersBtn) manageUsersBtn.style.display = 'none';
Â  Â  }
Â  }

Â  /**
Â  Â * Carga el perfil del usuario desde Supabase y actualiza la vista.
Â  Â */
async function loadUserProfile() {
  try {
    // âœ… CAMBIO AQUÃ
    const { data: { user }, error: authError } = await window.supabase.auth.getUser();
    if (authError || !user) {
      console.error('No hay sesiÃ³n activa, redirigiendo al login.');
      window.location.href = '../index.html';
      return;
    }

    // âœ… CAMBIO AQUÃ
    const { data: profile, error: profileError } = await window.supabase
      .from('profiles')
      .select('role, full_name')
      .eq('id', user.id)
      .single();

    if (profileError) throw profileError;

    if (profile) {
      updateProfileView(profile);
    } else {
      console.warn('Usuario autenticado pero sin perfil.');
      updateProfileView({ role: 'user', full_name: 'Usuario' });
    }
  } catch (error) {
    console.error('Error al cargar el perfil del usuario:', error.message);
    updateProfileView({ role: 'user', full_name: 'Usuario' });
  }
}

Â  // --- LÃ³gica de UI (Modales, Tabs, Filtros) ---
Â  function initUI() {
    // ... (Todo tu cÃ³digo de UI original va aquÃ­, sin cambios) ...
Â  Â  // --- Modal general ---
Â  Â  const modal = document.getElementById('modal');
Â  Â  const modalIcon = document.getElementById('modalIcon');
Â  Â  const modalTitle = document.getElementById('modalTitle');
Â  Â  const modalMessage = document.getElementById('modalMessage');
Â  Â  const modalClose = document.getElementById('modalClose');

Â  Â  function showModal(title, message, type = 'success') {
Â  Â  Â  modalTitle.textContent = title;
Â  Â  Â  modalMessage.textContent = message;
Â  Â  Â  modalIcon.className = `modal-icon ${type}`;
Â  Â  Â  modalIcon.innerHTML = type === 'success'
Â  Â  Â  Â  ? '<i class="fas fa-check-circle"></i>'
Â  Â  Â  Â  : '<i class="fas fa-info-circle"></i>';
Â  Â  Â  modal.classList.add('show');
Â  Â  }
Â  Â  function closeModal() {
Â  Â  Â  modal.classList.remove('show');
Â  Â  }
Â  Â  modalClose.addEventListener('click', closeModal);
Â  Â  modal.addEventListener('click', (e) => {
Â  Â  Â  if (e.target === modal) closeModal();
Â  Â  });

Â  Â  // --- Tabs ---
Â  Â  const tabs = document.querySelectorAll('.tab');
Â  Â  const tabContents = document.querySelectorAll('.tab-content');
Â  Â  tabs.forEach(tab => {
Â  Â  Â  tab.addEventListener('click', () => {
Â  Â  Â  Â  tabs.forEach(t => t.classList.remove('active'));
Â  Â  Â  Â  tabContents.forEach(tc => tc.classList.remove('active'));
Â  Â  Â  Â  tab.classList.add('active');
Â  Â  Â  Â  document.getElementById(tab.dataset.tab).classList.add('active');
Â  Â  Â  });
Â  Â  });

Â  Â  // --- Filtros ---
Â  Â  const filterBtns = document.querySelectorAll('.filter-btn');
Â  Â  const courseCards = document.querySelectorAll('.course-card[data-status]');
Â  Â  filterBtns.forEach(btn => {
Â  Â  Â  btn.addEventListener('click', () => {
Â  Â  Â  Â  filterBtns.forEach(b => b.classList.remove('active'));
Â  Â  Â  Â  btn.classList.add('active');
Â  Â  Â  Â  const filter = btn.dataset.filter;
Â  Â  Â  Â  courseCards.forEach(card => {
Â  Â  Â  Â  Â  card.style.display = (filter === 'all' || card.dataset.status === filter) ? 'flex' : 'none';
Â  Â  Â  Â  });
Â  Â  Â  });
Â  Â  });

Â  Â  // --- Buscador ---
Â  Â  const searchInput = document.getElementById('searchInput');
Â  Â  searchInput.addEventListener('input', (e) => {
Â  Â  Â  const searchTerm = e.target.value.toLowerCase();
Â  Â  Â  document.querySelectorAll('.course-card').forEach(card => {
Â  Â  Â  Â  const title = card.querySelector('h3').textContent.toLowerCase();
Â  Â  Â  Â  card.style.display = title.includes(searchTerm) ? 'flex' : 'none';
      });;
Â  Â  });

Â  Â  // --- Botones de acciÃ³n ---
Â  Â  document.querySelectorAll('.btn-enroll').forEach(btn => {
Â  Â  Â  btn.addEventListener('click', () => {
Â  Â  Â  Â  const courseName = btn.dataset.course;
Â  Â  Â  Â  showModal('Â¡InscripciÃ³n Exitosa!', `Te has inscrito al curso "${courseName}".`, 'success');
Â  Â  Â  });
Â  Â  });
Â  Â  document.querySelectorAll('.btn-download').forEach(btn => {
Â  Â  Â  btn.addEventListener('click', () => {
Â  Â  Â  Â  const certName = btn.dataset.cert;
Â  Â  Â  Â  showModal('Generando Certificado', `Tu certificado "${certName}" se estÃ¡ generando...`, 'success');
Â  Â  Â  });
Â  Â  });
Â  Â  document.querySelectorAll('.btn-reminder').forEach(btn => {
Â  Â  Â  btn.addEventListener('click', () => {
Â  Â  Â  Â  const courseName = btn.dataset.course;
Â  Â  Â  Â  showModal('Recordatorio Activado', `RecibirÃ¡s notificaciones del curso "${courseName}"`, 'info');
Â  Â  Â  });
Â  Â  });

Â  Â  // --- Notificaciones ---
Â  Â  const notificationBtn = document.getElementById('notificationBtn');
Â  Â  const notificationPanel = document.getElementById('notificationPanel');
Â  Â  const notificationClose = document.getElementById('notificationClose');
Â  Â  const markAllRead = document.getElementById('markAllRead');
Â  Â  if (notificationBtn && notificationPanel) {
Â  Â  Â  notificationBtn.addEventListener('click', (e) => {
Â  Â  Â  Â  e.stopPropagation();
Â  Â  Â  Â  notificationPanel.classList.toggle('show');
Â  Â  Â  });
Â  Â  Â  notificationClose?.addEventListener('click', () => notificationPanel.classList.remove('show'));
Â  Â  Â  markAllRead?.addEventListener('click', () => {
Â  Â  Â  Â  showModal('Notificaciones Actualizadas', 'Todas fueron marcadas como leÃ­das', 'info');
Â  Â  Â  Â  document.querySelector('.notification-badge').textContent = '0';
Â  Â  Â  Â  setTimeout(() => notificationPanel.classList.remove('show'), 1500);
Â  Â  Â  });
Â  Â  Â  document.addEventListener('click', (e) => {
Â  Â  Â  Â  if (!notificationPanel.contains(e.target) && !notificationBtn.contains(e.target)) {
Â  Â  Â  Â  Â  notificationPanel.classList.remove('show');
Â  Â  Â  Â  }
Â  Â  Â  });
Â  Â  }

Â  Â  // --- Modal de insignias ---
Â  Â  const badgeModal = document.getElementById('badgeModal');
Â  Â  const viewBadgesBtn = document.getElementById('viewBadgesBtn');
Â  Â  const badgeModalClose = document.getElementById('badgeModalClose');
Â  Â  if (viewBadgesBtn && badgeModal && badgeModalClose) {
Â  Â  Â  viewBadgesBtn.addEventListener('click', () => badgeModal.classList.add('show'));
Â  Â  Â  badgeModalClose.addEventListener('click', () => badgeModal.classList.remove('show'));
Â  Â  Â  badgeModal.addEventListener('click', (e) => {
Â  Â  Â  Â  if (e.target === badgeModal) badgeModal.classList.remove('show');
Â  Â  Â  });
Â  Â  }

Â  Â  // --- BotÃ³n de tema ---
Â  Â  const themeToggle = document.getElementById('themeToggle');
Â  Â  themeToggle?.addEventListener('click', () => {
Â  Â  Â  showModal('Cambio de Tema', 'El modo oscuro estarÃ¡ disponible prÃ³ximamente', 'info');
Â  Â  });

Â  Â  // --- AnimaciÃ³n de barras ---
Â  Â  const progressBars = document.querySelectorAll('.progress-bar-fill');
Â  Â  progressBars.forEach(bar => {
Â  Â  Â  const width = bar.style.width;
Â  Â  Â  bar.style.width = '0%';
Â  Â  Â  setTimeout(() => {
Â  Â  Â  Â  bar.style.width = width;
Â  Â  Â  }, 100);
Â  Â  });
Â  }

Â  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Â  // FUNCIÃ“N PRINCIPAL DE ARRANQUE
Â  // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
Â  async function mainInit() {
Â  Â  // 1. Carga la config del tenant
Â  Â  const config = await loadTenantConfig();
Â  Â  applyConfiguration(config);
Â  Â  console.log('âœ… Tenant listo');

Â  Â  // 2. Carga el perfil de usuario (para permisos)
Â  Â  await loadUserProfile();
Â  Â  console.log('âœ… Perfil de usuario cargado');

Â  Â  initUI();
Â  Â  console.log('âœ… UI inicializada');
Â  }

Â  // --- Disparador de Carga ---
Â  if (document.readyState === 'loading') {
Â  Â  document.addEventListener('DOMContentLoaded', mainInit);
Â  } else {
Â  Â  mainInit();
Â  }

})();
</script>
<script src="../componentes/supabase-client.js"></script>
</body>
</html>