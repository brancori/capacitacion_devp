<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mi Perfil de Capacitación PRO</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="./profile.css">
    <link rel="stylesheet" href="../componentes/global.css">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <style>
  /* Anti-flicker solo para esta página */
  body {
    visibility: hidden !important;
    opacity: 0 !important;
  }

  body.loaded {
    visibility: visible !important;
    opacity: 1 !important;
    transition: opacity 0.2s ease-in;
  }
</style>
</head>
<body>

    <!-- Top Navigation -->
    <nav class="top-navbar">
        <div class="logo-section">
            <h2 id="companyName"><i class="fas fa-graduation-cap"></i> TROX Academy</h2>
        </div>
        <div class="nav-actions">
            <button class="notification-btn" id="notificationBtn">
                <i class="fas fa-bell"></i>
                <span class="notification-badge">3</span>
            </button>
            <button class="theme-toggle" id="themeToggle">
                <i class="fas fa-moon"></i>
            </button>
            <a href="../index.html" class="btn btn-outline">
                <i class="fas fa-sign-out-alt"></i> Salir
            </a>
        </div>
    </nav>

    <div class="container">
        
        <!-- Main Grid -->
        <div class="main-grid">
            <!-- Sidebar -->
            <div class="sidebar">
                <!-- Profile Card -->
                <div class="profile-card">
                    <div class="avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <h2 id="profileName">Cargando...</h2>
                    <p class="role">Usuario | ID: ...</p>
                    
                    <div class="progress-donut">
                        <svg viewBox="0 0 150 150">
                            <circle class="progress-donut-bg" cx="75" cy="75" r="69"></circle>
                            <circle class="progress-donut-fg" cx="75" cy="75" r="69"></circle>
                        </svg>
                        <span class="progress-text">0%</span>
                    </div>
                    <p style="color: var(--primary); font-weight: 600; margin-bottom: 1rem;">
                        Cargando progreso...
                    </p>
                    <button class="btn btn-primary" style="width: 100%;">
                        <i class="fas fa-user-edit"></i> Editar Perfil
                    </button>
                    <a href="../componentes/admin.html" class="btn btn-outline" id="manageUsersBtn" style="width: 100%; margin-top: 0.75rem; display: none;">
                        <i class="fas fa-users-cog"></i> Administración
                    </a>
                </div>

                <!-- Badges Card -->
                <div class="badges-card">
                    <h3><i class="fas fa-trophy"></i> Certificaciones</h3>
                    <div class="badges-grid">
                        <!-- Se llenará con JS -->
                        <p style="font-size: 0.8rem; color: #888;">Cargando insignias...</p>
                    </div>
                    <button class="btn btn-outline" id="viewBadgesBtn" style="width: 100%; margin-top: 1rem; font-size: 0.9rem;">
                        <i class="fas fa-info-circle"></i> Ver Requisitos
                    </button>
                </div>

                <!-- Calendar Card -->
                <div class="calendar-card">
                    <h3><i class="far fa-calendar-alt"></i> Próximos Vencimientos</h3>
                    <!-- Se llenará con JS -->
                    <p style="font-size: 0.8rem; color: #888;">Cargando calendario...</p>
                </div>
            </div> <!-- Cierre de .sidebar -->

            <!-- Main Content -->
            <div class="content-area">
                
                <!-- Stats Grid -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon total">
                            <i class="fas fa-book"></i>
                        </div>
                        <div class="stat-content">
                            <h3>0</h3>
                            <p>Cursos Totales</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon completed">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="stat-content">
                            <h3>0</h3>
                            <p>Completados</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon pending">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-content">
                            <h3>0</h3>
                            <p>En Progreso</p>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon urgent">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="stat-content">
                            <h3>0</h3>
                            <p>Urgente</p>
                        </div>
                    </div>
                </div>

                <!-- Filter Bar -->
                <div class="filter-bar">
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" id="searchInput" placeholder="Buscar cursos...">
                    </div>
                    <div class="filter-group">
                        <!-- Estos filtros visuales pueden requerir lógica JS adicional si quieres filtrar dentro de las tabs -->
                        <!-- Por ahora solo son decorativos o funcionales si tu JS original de filtros sigue activo -->
                    </div>
                </div>

                <!-- Tabs -->
                <div class="tabs">
                    <div class="tab active" data-tab="assigned">Asignados</div>
                    <div class="tab" data-tab="completed">Completados</div>
                    <div class="tab" data-tab="timeline">Historial</div>
                    <div class="tab" data-tab="recommendations">Recomendados</div>
                </div>

                <!-- Tab Content: Assigned Courses -->
                <div class="tab-content active" id="assigned">
                    <div class="course-grid" id="assignedCoursesContainer">
                        <p style="text-align: center; color: var(--text-secondary); width: 100%;">Cargando cursos pendientes...</p>
                    </div>
                </div>

                <!-- Tab Content: Completed Courses -->
                <div class="tab-content" id="completed">
                    <div class="course-grid" id="completedCoursesContainer">
                        <p style="text-align: center; color: var(--text-secondary); width: 100%;">Cargando cursos completados...</p>
                    </div>
                </div>

                <!-- Tab Content: Timeline -->
                <div class="tab-content" id="timeline">
                    <div class="timeline">
                        <!-- Se llenará con JS -->
                    </div>
                </div>

                <!-- Tab Content: Recommendations -->
                <div class="tab-content" id="recommendations">
                    <h2 style="margin-bottom: 1rem; color: var(--primary);">
                        <i class="fas fa-magic"></i> Cursos Recomendados Para Ti
                    </h2>
                    <p style="color: var(--text-secondary); margin-bottom: 2rem;">
                        Basado en tu perfil, historial y cursos completados
                    </p>
                    
                    <div class="recommendations-grid">
                        <!-- Recommendation 1 -->
                        <div class="recommendation-card">
                            <div class="rec-header">
                                <div class="rec-icon">
                                    <i class="fas fa-hard-hat"></i>
                                </div>
                                <div>
                                    <h3 style="margin-bottom: 0.25rem;">Seguridad en Alturas</h3>
                                    <p style="font-size: 0.85rem; color: var(--text-secondary);">
                                        Nivel Intermedio
                                    </p>
                                </div>
                                <span class="match-score">92%</span>
                            </div>
                            <p style="color: var(--text-secondary); margin-bottom: 1rem; font-size: 0.9rem;">
                                Continuación ideal después de completar Inducción de Seguridad
                            </p>
                            <div style="display: flex; gap: 0.5rem; margin-bottom: 1rem; flex-wrap: wrap;">
                                <span style="background: #e6f0ff; color: var(--primary); padding: 0.25rem 0.75rem; border-radius: 15px; font-size: 0.8rem;">
                                    6 horas
                                </span>
                                <span style="background: #e6f0ff; color: var(--primary); padding: 0.25rem 0.75rem; border-radius: 15px; font-size: 0.8rem;">
                                    Certificación
                                </span>
                            </div>
                            <button class="btn btn-success btn-enroll" data-course="Seguridad en Alturas" style="width: 100%;">
                                <i class="fas fa-plus-circle"></i> Inscribirme
                            </button>
                        </div>

                        <!-- Recommendation 2 -->
                        <div class="recommendation-card">
                            <div class="rec-header">
                                <div class="rec-icon">
                                    <i class="fas fa-shield-alt"></i>
                                </div>
                                <div>
                                    <h3 style="margin-bottom: 0.25rem;">EPP Avanzado</h3>
                                    <p style="font-size: 0.85rem; color: var(--text-secondary);">
                                        Nivel Avanzado
                                    </p>
                                </div>
                                <span class="match-score">88%</span>
                            </div>
                            <p style="color: var(--text-secondary); margin-bottom: 1rem; font-size: 0.9rem;">
                                Especialización complementaria a tus cursos actuales
                            </p>
                            <div style="display: flex; gap: 0.5rem; margin-bottom: 1rem; flex-wrap: wrap;">
                                <span style="background: #e6f0ff; color: var(--primary); padding: 0.25rem 0.75rem; border-radius: 15px; font-size: 0.8rem;">
                                    4 horas
                                </span>
                                <span style="background: #e6f0ff; color: var(--primary); padding: 0.25rem 0.75rem; border-radius: 15px; font-size: 0.8rem;">
                                    Práctico
                                </span>
                            </div>
                            <button class="btn btn-success btn-enroll" data-course="EPP Avanzado" style="width: 100%;">
                                <i class="fas fa-plus-circle"></i> Inscribirme
                            </button>
                        </div>

                        <!-- Recommendation 3 -->
                        <div class="recommendation-card">
                            <div class="rec-header">
                                <div class="rec-icon">
                                    <i class="fas fa-bolt"></i>
                                </div>
                                <div>
                                    <h3 style="margin-bottom: 0.25rem;">Riesgo Eléctrico</h3>
                                    <p style="font-size: 0.85rem; color: var(--text-secondary);">
                                        Nivel Básico
                                    </p>
                                </div>
                                <span class="match-score">85%</span>
                            </div>
                            <p style="color: var(--text-secondary); margin-bottom: 1rem; font-size: 0.9rem;">
                                Muy solicitado en tu área de trabajo
                            </p>
                            <div style="display: flex; gap: 0.5rem; margin-bottom: 1rem; flex-wrap: wrap;">
                                <span style="background: #e6f0ff; color: var(--primary); padding: 0.25rem 0.75rem; border-radius: 15px; font-size: 0.8rem;">
                                    3 horas
                                </span>
                                <span style="background: #e6f0ff; color: var(--primary); padding: 0.25rem 0.75rem; border-radius: 15px; font-size: 0.8rem;">
                                    Popular
                                </span>
                            </div>
                            <button class="btn btn-success btn-enroll" data-course="Riesgo Eléctrico" style="width: 100%;">
                                <i class="fas fa-plus-circle"></i> Inscribirme
                            </button>
                        </div>
                    </div>
                </div>
            </div> <!-- Cierre de .content-area -->
        </div> <!-- Cierre de .main-grid -->
    </div> <!-- Cierre de .container -->

    <!-- Modal General -->
    <div class="modal" id="modal">
        <div class="modal-content">
            <div class="modal-icon" id="modalIcon"></div>
            <h3 id="modalTitle"></h3>
            <p id="modalMessage"></p>
            <button class="btn btn-primary" id="modalClose" style="width: 100%;">Aceptar</button>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="../componentes/supabase-client.js?v=3"></script>
    <script src="./profile.js?v=3.3"></script>
</body>
</html>